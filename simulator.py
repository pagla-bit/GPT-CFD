<placeholder: full simulator.py content from scaffold>